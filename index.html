<html>
  <head>
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="crate-obj" src="crate.obj"></a-asset-item>
        <a-asset-item id="crate-mtl" src="crate.mtl"></a-asset-item>
      </a-assets>

      <!-- Using the asset management system. -->

      <!-- Defining the URL inline. Not recommended but may be more comfortable. -->
      <!-- <a-obj-model src="crate.obj" mtl="crate.mtl"></a-obj-model> -->

      <a-entity
        environment="preset: forest; groundColor: #445; grid: none; ground: canyon;groundTexture: walkernoise;dressing:none"
      ></a-entity>
      <!-- GROUND:none, flat, hills, canyon, spikes, noise -->
      <!-- environment:Valid values: none, default, contact, egypt, checkerboard, forest, goaland, yavapai, goldmine, 
      threetowers, poison, arches, tron, japan, dream, volcano, starry, osiris -->
      <!-- groundTexture none, checkerboard, squares, walkernoise -->
      <!-- dressing Valid values: none, cubes, pyramids, cylinders, towers, mushrooms, trees, apparatus, torii. -->
      <a-entity id="maze" position="-4 1 -10">
        <a-obj-model
          position="6 -8 10"
          src="#crate-obj"
          mtl="#crate-mtl"
        ></a-obj-model>
        <a-text
          position="-0.4 -1.5 0"
          id="devicemotionX"
          rotation="-90 0 0"
          value="devicemotionX"
          color="black"
        ></a-text>

        <a-text
          position="-0.4 -1.5 0.4"
          id="devicemotionY"
          rotation="-90 0 0"
          value="devicemotionY"
          color="black"
        ></a-text>

        <a-text
          id="devicemotionZ"
          position="-0.4 -1.5 0.8"
          rotation="-90 0 0"
          value="devicemotionZ"
          color="black"
        ></a-text>

        <a-sky
          src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg"
          position="0 0 0"
          rotation="0 0 0"
          opacity="0.5"
        ></a-sky>
        <a-entity
          id="camera"
          camera
          look-controls
          collider-check
          rotation="0 0 0"
          position="0 0 0"
        ></a-entity>

        <!-- <a-entity id="camera" position="0 0 0"> <a-camera></a-camera></a-entity> -->
        <!-- <a-entity id="camera" position="0 0 0">
          <a-camera></a-camera>
        </a-entity> -->
      </a-entity>
    </a-scene>
  </body>
  <script>
    const something = document.body.querySelector("#something");
    const devicemotionX = document.body.querySelector("#devicemotionX");
    const devicemotionY = document.body.querySelector("#devicemotionY");
    const devicemotionZ = document.body.querySelector("#devicemotionZ");
    // const deviceorientation = document.body.querySelector("#deviceorientation");
    const camera = document.getElementById("camera");

    const speed = 0.01;
    const handleOrientation = event => {
      console.log("START :", handleOrientation);
      // deviceorientation.setAttribute(
      //   "value",
      //   `START deviceorientation ${event.alpha} / ${event.beta} / ${event.gamma}`
      // );
    };

    const handleMotion = event => {
      console.log("START :", handleMotion);

      // something.setAttribute("value", "SET UP! handleMotion");
      // devicemotionX.setAttribute("value", "SET UP! handleMotion");

      if (camera) {
        let position = camera.getAttribute("position");
        let rotation = camera.getAttribute("rotation");
        // devicemotion.setAttribute(
        //   "value",
        `START position.x ${Math.cos(((rotation.y - 90) * Math.PI) / 180) *
          speed} ` //   "value", // devicemotion2.setAttribute( // );
        `START position.y ${MMath.sin(((rotation.y - 90) * Math.PI) / 180) *
          speed} `;
        // );
        // position.x += event.acceleration.x;
        // position.z += event.acceleration.y;

        const x = Math.floor(event.acceleration.x * 10);
        const y = Math.floor(event.acceleration.y * 10);
        const z = Math.floor(event.acceleration.z * 10);
        devicemotionX.setAttribute("value", `START X ${x} `);
        devicemotionY.setAttribute("value", `START Y ${y} `);
        devicemotionZ.setAttribute("value", `START Z ${z}`);
        camera.setAttribute("position", position);
      }
    };

    // setInterval(() => {
    const position = camera.getAttribute("position");
    const rotation = camera.getAttribute("rotation");
    // console.log("rotation :", rotation);
    position.x += -Math.cos(((rotation.y - 90) * Math.PI) / 180) * speed;
    position.z += Math.sin(((rotation.y - 90) * Math.PI) / 180) * speed;
    camera.setAttribute("position", position);
    // devicemotionX.setAttribute("position", position);
    // devicemotionY.setAttribute("position", position);
    // devicemotionZ.setAttribute("position", position);
    // console.log("position :", position);
    // console.log("camera :", camera);
    // }, 50);
    let moving = false;
    // window.addEventListener(
    //   "touchstart",
    //   function() {
    setInterval(() => {
      // if (moving) return;
      // moving = true;d
      const position = camera.getAttribute("position");
      const rotation = camera.getAttribute("rotation");
      console.log("rotation :", rotation);
      position.x += -Math.cos(((rotation.y - 90) * Math.PI) / 180) * speed;
      position.z += Math.sin(((rotation.y - 90) * Math.PI) / 180) * speed;
      camera.setAttribute("position", position);
    }, 50);
    // },
    // false
    // );
    //
    // window.addEventListener(
    // "touchend",
    // function() {
    //   moving = false;
    // },
    // false
    // );
    window.addEventListener("deviceorientation", handleOrientation, true);
    window.addEventListener("devicemotion", handleMotion, true);
    //とりあえずオブジェクトを作って移動は諦める　ジャンプは可能（リンク）
    //ワンダーランド的な

    //移動できるようにする。
    devicemotionX.setAttribute("value", `START X  `);
    devicemotionY.setAttribute("value", `START Y  `);
    devicemotionZ.setAttribute("value", `START Z `);
    console.log("START1 :", devicemotionX);
    console.log("START2 :", devicemotionY);
    console.log("START3 :", devicemotionZ);
  </script>
</html>
